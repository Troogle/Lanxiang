(function(k,f){"object"==typeof exports?module.exports=f():"function"==typeof define&&define.amd?define(f):k.Spinner=f()})(this,function(){function k(c,a){var b=document.createElement(c||"div"),d;for(d in a)b[d]=a[d];return b}function f(c){for(var a=1,b=arguments.length;a<b;a++)c.appendChild(arguments[a]);return c}function x(c,a,b,d){var e=["opacity",a,~~(100*c),b,d].join("-");b=.01+b/d*100;d=Math.max(1-(1-c)/a*(100-b),c);var g=r.substring(0,r.indexOf("Animation")).toLowerCase();s[e]||(p.insertRule("@"+(g&&"-"+g+"-"||"")+"keyframes "+e+"{0%{opacity:"+d+"}"+b+"%{opacity:"+c+"}"+(b+.01)+"%{opacity:1}"+(b+a)%100+"%{opacity:"+c+"}100%{opacity:"+d+"}}",p.cssRules.length),s[e]=1);return e}function q(c,a){var b=c.style,d,e;if(void 0!==b[a])return a;a=a.charAt(0).toUpperCase()+a.slice(1);for(e=0;e<t.length;e++)if(d=t[e]+a,void 0!==b[d])return d}function l(c,a){for(var b in a)c.style[q(c,b)||b]=a[b];return c}function v(c){for(var a=1;a<arguments.length;a++){var b=arguments[a],d;for(d in b)void 0===c[d]&&(c[d]=b[d])}return c}function w(c){for(var a={x:c.offsetLeft,y:c.offsetTop};c=c.offsetParent;)a.x+=c.offsetLeft,a.y+=c.offsetTop;return a}function m(c){if("undefined"==typeof this)return new m(c);this.opts=v(c||{},m.defaults,y)}function z(){function c(a,b){return k("<"+a+' xmlns="urn:schemas-microsoft.com:vml" class="spin-vml">',b)}p.addRule(".spin-vml","behavior:url(#default#VML)");m.prototype.lines=function(a,b){function d(){return l(c("group",{coordsize:u+" "+u,coordorigin:-g+" "+-g}),{width:u,height:u})}function e(a,e,h){f(k,f(l(d(),{rotation:360/b.lines*a+"deg",left:~~e}),f(l(c("roundrect",{arcsize:b.corners}),{width:g,height:b.width,left:b.radius,top:-b.width>>1,filter:h}),c("fill",{color:b.color,opacity:b.opacity}),c("stroke",{opacity:0}))))}var g=b.length+b.width,u=2*g,h=2*-(b.width+b.length)+"px",k=l(d(),{position:"absolute",top:h,left:h});if(b.shadow)for(h=1;h<=b.lines;h++)e(h,-2,"progid:DXImageTransform.Microsoft.Blur(pixelradius=2,makeshadow=1,shadowopacity=.3)");for(h=1;h<=b.lines;h++)e(h);return f(a,k)};m.prototype.opacity=function(a,b,c,e){a=a.firstChild;e=e.shadow&&e.lines||0;a&&b+e<a.childNodes.length&&(a=(a=(a=a.childNodes[b+e])&&a.firstChild)&&a.firstChild)&&(a.opacity=c)}}var t=["webkit","Moz","ms","O"],s={},r,p=function(){var c=k("style",{type:"text/css"});f(document.getElementsByTagName("head")[0],c);return c.sheet||c.styleSheet}(),y={lines:12,length:7,width:5,radius:10,rotate:0,corners:1,color:"#000",direction:1,speed:1,trail:100,opacity:.25,fps:20,zIndex:2E9,className:"spinner",top:"auto",left:"auto",position:"relative"};m.defaults={};v(m.prototype,{spin:function(c){this.stop();var a=this,b=a.opts,d=a.el=l(k(0,{className:b.className}),{position:b.position,width:0,zIndex:b.zIndex}),e=b.radius+b.length+b.width,g,f;c&&(c.insertBefore(d,c.firstChild||null),f=w(c),g=w(d),l(d,{left:("auto"==b.left?f.x-g.x+(c.offsetWidth>>1):parseInt(b.left,10)+e)+"px",top:("auto"==b.top?f.y-g.y+(c.offsetHeight>>1):parseInt(b.top,10)+e)+"px"}));d.setAttribute("role","progressbar");a.lines(d,a.opts);if(!r){var h=0,m=(b.lines-1)*(1-b.direction)/2,p,q=b.fps,n=q/b.speed,s=(1-b.opacity)/(n*b.trail/100),t=n/b.lines;(function A(){h++;for(var c=0;c<b.lines;c++)p=Math.max(1-(h+(b.lines-c)*t)%n*s,b.opacity),a.opacity(d,c*b.direction+m,p,b);a.timeout=a.el&&setTimeout(A,~~(1E3/q))})()}return a},stop:function(){var c=this.el;c&&(clearTimeout(this.timeout),c.parentNode&&c.parentNode.removeChild(c),this.el=void 0);return this},lines:function(c,a){function b(b,c){return l(k(),{position:"absolute",width:a.length+a.width+"px",height:a.width+"px",background:b,boxShadow:c,transformOrigin:"left",transform:"rotate("+~~(360/a.lines*d+a.rotate)+"deg) translate("+a.radius+"px,0)",borderRadius:(a.corners*a.width>>1)+"px"})}for(var d=0,e=(a.lines-1)*(1-a.direction)/2,g;d<a.lines;d++)g=l(k(),{position:"absolute",top:1+~(a.width/2)+"px",transform:a.hwaccel?"translate3d(0,0,0)":"",opacity:a.opacity,animation:r&&x(a.opacity,a.trail,e+d*a.direction,a.lines)+" "+1/a.speed+"s linear infinite"}),a.shadow&&f(g,l(b("#000","0 0 4px #000"),{top:"2px"})),f(c,f(g,b(a.color,"0 0 1px rgba(0,0,0,.1)")));return c},opacity:function(c,a,b){a<c.childNodes.length&&(c.childNodes[a].style.opacity=b)}});var n=l(k("group"),{behavior:"url(#default#VML)"});!q(n,"transform")&&n.adj?z():r=q(n,"animation");return m});